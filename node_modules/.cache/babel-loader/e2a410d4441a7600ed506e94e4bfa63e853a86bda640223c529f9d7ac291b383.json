{"ast":null,"code":"import _objectSpread from\"/Users/zuuki/Desktop/Web/snake-game/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback,useRef}from'react';import{db}from'../firebase';import{collection,addDoc,query,orderBy,limit,getDocs,where,onSnapshot}from'firebase/firestore';import'../styles/SnakeGame.css';// コレクション名を取得する関数を追加\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getCollectionName=(mode,difficulty)=>{if(mode==='difficulty'){switch(difficulty){case'beginner':return'scoreslow';case'intermediate':return'scoresmiddle';case'advanced':return'scoreshigh';default:return'scores';}}return'scores';};const SnakeGame=_ref=>{let{mode='normal',difficulty='normal',settings=null,onGameOver=null}=_ref;const gridSize=20;const centerX=Math.floor(gridSize/2);const centerY=Math.floor(gridSize/2);// initialSnakeをuseMemoで最適化\nconst initialSnake=React.useMemo(()=>[[centerX,centerY],// 頭\n[centerX-1,centerY],// 胴体\n[centerX-2,centerY]// 尾\n],[centerX,centerY]);const[snake,setSnake]=useState(initialSnake);const[food,setFood]=useState([0,0]);const[specialFood,setSpecialFood]=useState(null);// { type: 'yellow' | 'blue' | 'black', position: [x, y] }\nconst[direction,setDirection]=useState('RIGHT');const directionRef=useRef(direction);const[gameOver,setGameOver]=useState(false);const[score,setScore]=useState(0);const[isPlaying,setIsPlaying]=useState(false);const[highScore,setHighScore]=useState(()=>{const saved=localStorage.getItem('snakeHighScore');return saved?parseInt(saved):0;});const[topScores,setTopScores]=useState([]);const[timeLeft,setTimeLeft]=useState(mode==='time'?settings.initialTime:null);const[isTimeUp,setIsTimeUp]=useState(false);const calculateSpeed=useCallback(score=>{if(mode==='difficulty'&&settings){const speedIncrease=Math.floor(score/5)*settings.speedIncrease;return Math.max(settings.minSpeed,settings.speed-speedIncrease);}// 通常モードのデフォルト速度計算\nconst baseSpeed=200;const speedIncrease=Math.floor(score/5)*10;return Math.max(60,baseSpeed-speedIncrease);},[mode,settings]);// generateFoodを先に定義\nconst generateFood=useCallback(()=>{const getRandomPosition=()=>[Math.floor(Math.random()*gridSize),Math.floor(Math.random()*gridSize)];const isPositionOccupied=pos=>snake.some(segment=>segment[0]===pos[0]&&segment[1]===pos[1]);let newFood;do{newFood=getRandomPosition();}while(isPositionOccupied(newFood));setFood(newFood);},[snake,gridSize]);// 特殊エサの生成関数\nconst generateSpecialFood=useCallback(()=>{if(mode!=='time'||!isPlaying)return;const types=['yellow','blue','black'];const randomType=types[Math.floor(Math.random()*types.length)];const getRandomPosition=()=>[Math.floor(Math.random()*gridSize),Math.floor(Math.random()*gridSize)];const isPositionOccupied=pos=>snake.some(segment=>segment[0]===pos[0]&&segment[1]===pos[1])||food[0]===pos[0]&&food[1]===pos[1];let newFood;do{newFood=getRandomPosition();}while(isPositionOccupied(newFood));setSpecialFood({type:randomType,position:newFood});// 5秒後に特殊エサを消す\nsetTimeout(()=>{setSpecialFood(null);},5000);},[snake,food,gridSize,mode,isPlaying]);// 特殊エサの効果を処理\nconst handleSpecialFoodEffect=useCallback(type=>{switch(type){case'yellow':setScore(s=>s+3);// 黄色は3点追加\nbreak;case'blue':setTimeLeft(prev=>prev+5);// 青は時間5秒追加\nbreak;case'black':setSnake(prev=>{// 黒はヘビの長さを5増やす\nconst tail=prev[prev.length-1];const newSegments=Array(5).fill(tail);return[...prev,...newSegments];});break;default:break;}},[]);// resetGameの定義\nconst resetGame=useCallback(()=>{setSnake(initialSnake);setDirection('RIGHT');setGameOver(false);setScore(0);setIsPlaying(false);setFood([0,0]);// エサを初期位置に戻す（次回開始時に新しい位置が生成される）\n},[initialSnake]);useEffect(()=>{directionRef.current=direction;},[direction]);const moveSnake=useCallback(()=>{if(!isPlaying||gameOver)return;setSnake(prevSnake=>{const head=[...prevSnake[0]];switch(directionRef.current){case'UP':head[1]-=1;break;case'DOWN':head[1]+=1;break;case'LEFT':head[0]-=1;break;case'RIGHT':head[0]+=1;break;default:break;}// 壁やヘビ自身との衝突判定\nif(head[0]<0||head[0]>=gridSize||head[1]<0||head[1]>=gridSize||prevSnake.some(segment=>segment[0]===head[0]&&segment[1]===head[1])){setGameOver(true);setIsPlaying(false);return prevSnake;}const newSnake=[head];// 通常のエサとの衝突判定\nif(head[0]===food[0]&&head[1]===food[1]){setScore(s=>s+1);generateFood();newSnake.push(...prevSnake);}else{newSnake.push(...prevSnake.slice(0,-1));}// 特殊エサとの衝突判定を追加\nif(specialFood&&head[0]===specialFood.position[0]&&head[1]===specialFood.position[1]){handleSpecialFoodEffect(specialFood.type);setSpecialFood(null);}return newSnake;});},[isPlaying,gameOver,food,generateFood,gridSize,specialFood,handleSpecialFoodEffect]);// エサの生成を管理するuseEffect\nuseEffect(()=>{// エサが初期位置[0,0]の時のみ生成\nif(food[0]===0&&food[1]===0){generateFood();}},[generateFood,food]);// キーボード入力とゲームループのuseEffectを修正（resetGameを先に定義）\nuseEffect(()=>{const handleKeyPress=e=>{if(e.key==='ArrowUp'||e.key==='ArrowDown'||e.key==='ArrowLeft'||e.key==='ArrowRight'||e.code==='Space'){e.preventDefault();}if(e.code==='Space'){if(gameOver){resetGame();}else{setIsPlaying(prev=>!prev);}return;}if(!isPlaying)return;switch(e.key){case'ArrowUp':if(directionRef.current!=='DOWN')setDirection('UP');break;case'ArrowDown':if(directionRef.current!=='UP')setDirection('DOWN');break;case'ArrowLeft':if(directionRef.current!=='RIGHT')setDirection('LEFT');break;case'ArrowRight':if(directionRef.current!=='LEFT')setDirection('RIGHT');break;default:break;}};document.addEventListener('keydown',handleKeyPress);const gameInterval=setInterval(moveSnake,calculateSpeed(score));return()=>{document.removeEventListener('keydown',handleKeyPress);clearInterval(gameInterval);};},[moveSnake,gameOver,isPlaying,score,calculateSpeed,resetGame]);const startGame=()=>{if(!isPlaying&&!gameOver){if(food[0]===0&&food[1]===0){generateFood();// エサが初期位置の場合のみ生成\n}setIsPlaying(true);}};// スコアを保存する関数を修正\nconst updateScores=useCallback(async newScore=>{try{let collectionName;// モードに応じたコレクション名を設定\nif(mode==='time'){if(timeLeft>0)return;// 時間が残っている場合は記録しない\ncollectionName='scorestime';}else if(mode==='difficulty'){collectionName=getCollectionName(mode,difficulty);}else{collectionName='scores';// 通常モード\n}const scoresRef=collection(db,collectionName);const scoreData={score:newScore,date:new Date()};await addDoc(scoresRef,scoreData);}catch(error){console.error('Error saving score:',error);}},[mode,difficulty,timeLeft]);// Firestoreのリアルタイムリスナーを設定\nuseEffect(()=>{// コレクション名の設定\nconst collectionName=mode==='time'?'scorestime':getCollectionName(mode,difficulty);const scoresRef=collection(db,collectionName);// クエリの設定\nconst queryConstraints=[orderBy('score','desc'),limit(10)];const q=query(scoresRef,...queryConstraints);// リアルタイムリスナーを設定\nconst unsubscribe=onSnapshot(q,snapshot=>{const scores=snapshot.docs.map(doc=>_objectSpread(_objectSpread({id:doc.id},doc.data()),{},{date:doc.data().date.toDate().toLocaleString()}));// 同点のスコアに同じ順位を付ける\nlet currentRank=1;let prevScore=null;const rankedScores=scores.map(score=>{if(prevScore!==null&&score.score!==prevScore){currentRank=scores.filter(s=>s.score>score.score).length+1;}prevScore=score.score;return _objectSpread(_objectSpread({},score),{},{rank:currentRank});});const topScores=rankedScores.filter(score=>score.rank<=5);setTopScores(topScores);});return()=>unsubscribe();},[mode,difficulty]);// 制限時間の処理\nuseEffect(()=>{if(mode!=='time'||!isPlaying)return;const timer=setInterval(()=>{setTimeLeft(prev=>{if(prev<=0){clearInterval(timer);setIsTimeUp(true);setIsPlaying(false);// スコアの記録は別のuseEffectで行う\nreturn 0;}return prev-1;});},1000);return()=>clearInterval(timer);},[isPlaying,mode]);// 時間切れ時のスコア記録用のuseEffect\nuseEffect(()=>{if(mode==='time'&&timeLeft===0&&!isPlaying&&!gameOver){updateScores(score);}},[mode,timeLeft,isPlaying,gameOver,score,updateScores]);// ゲームオーバー時の処理を修正\nuseEffect(()=>{if(!gameOver)return;if(mode==='time'&&timeLeft>0){// 制限時間モードでは即座に再開\nsetTimeLeft(prev=>Math.max(0,prev-settings.penaltyTime));setGameOver(false);setSnake(initialSnake);setDirection('RIGHT');setIsPlaying(true);generateFood();// 新しい餌を生成\n}},[gameOver,mode,timeLeft,settings,initialSnake,generateFood]);// ゲームオーバー時のスコア更新を追加\nuseEffect(()=>{if(gameOver&&score>0&&mode!=='time'){updateScores(score);}},[gameOver,score,mode,updateScores]);// ハイスコアの更新処理を追加\nuseEffect(()=>{if(score>highScore){setHighScore(score);localStorage.setItem('snakeHighScore',score.toString());}},[score,highScore]);// ランダムな間隔で特殊エサを生成\nuseEffect(()=>{if(mode!=='time'||!isPlaying)return;const interval=setInterval(()=>{if(!specialFood){generateSpecialFood();}},Math.random()*5000+5000);// 5-10秒のランダムな間隔\nreturn()=>clearInterval(interval);},[mode,isPlaying,specialFood,generateSpecialFood]);return/*#__PURE__*/_jsxs(\"div\",{className:\"snake-game\",children:[/*#__PURE__*/_jsx(\"h2\",{children:mode==='time'?'スネークゲーム - 制限時間モード':mode==='difficulty'?\"\\u30B9\\u30CD\\u30FC\\u30AF\\u30B2\\u30FC\\u30E0 - \".concat(settings.label):'スネークゲーム'}),mode==='time'&&/*#__PURE__*/_jsxs(\"div\",{className:\"time-left\",children:[\"\\u6B8B\\u308A\\u6642\\u9593: \",timeLeft,\"\\u79D2\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"score-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"score\",children:[\"\\u73FE\\u5728\\u306E\\u30B9\\u30B3\\u30A2: \",score]}),/*#__PURE__*/_jsxs(\"div\",{className:\"high-score\",children:[\"\\u30CF\\u30A4\\u30B9\\u30B3\\u30A2: \",highScore]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"game-board\",children:Array.from({length:gridSize},(_,row)=>/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:Array.from({length:gridSize},(_,col)=>{const isSnake=snake.some(segment=>segment[0]===col&&segment[1]===row);const isFood=food[0]===col&&food[1]===row;const isSpecialFood=specialFood&&specialFood.position[0]===col&&specialFood.position[1]===row;return/*#__PURE__*/_jsx(\"div\",{className:\"cell \\n                    \".concat(isSnake?'snake':'',\" \\n                    \").concat(isFood?'food':'',\" \\n                    \").concat(isSpecialFood?\"special-food-\".concat(specialFood.type):'')},\"\".concat(row,\"-\").concat(col));})},row))}),/*#__PURE__*/_jsxs(\"div\",{className:\"controls\",children:[!isPlaying&&!gameOver&&!isTimeUp&&/*#__PURE__*/_jsx(\"button\",{onClick:startGame,className:\"start-button\",children:\"\\u30B9\\u30BF\\u30FC\\u30C8\"}),isPlaying&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsPlaying(false),className:\"pause-button\",children:\"\\u4E00\\u6642\\u505C\\u6B62\"}),gameOver&&mode!=='time'&&/*#__PURE__*/_jsx(\"button\",{onClick:resetGame,className:\"retry-button\",children:\"\\u3082\\u3046\\u4E00\\u5EA6\\u30D7\\u30EC\\u30A4\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ranking\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u6B74\\u4EE3\\u30C8\\u30C3\\u30D75\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ranking-list\",children:topScores.map(score=>/*#__PURE__*/_jsxs(\"div\",{className:\"ranking-item\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"rank\",children:[score.rank,\"\\u4F4D\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"score-value\",children:[score.score,\"\\u70B9\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"score-date\",children:score.date})]},score.id))})]})]});};export default SnakeGame;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","db","collection","addDoc","query","orderBy","limit","getDocs","where","onSnapshot","jsx","_jsx","jsxs","_jsxs","getCollectionName","mode","difficulty","SnakeGame","_ref","settings","onGameOver","gridSize","centerX","Math","floor","centerY","initialSnake","useMemo","snake","setSnake","food","setFood","specialFood","setSpecialFood","direction","setDirection","directionRef","gameOver","setGameOver","score","setScore","isPlaying","setIsPlaying","highScore","setHighScore","saved","localStorage","getItem","parseInt","topScores","setTopScores","timeLeft","setTimeLeft","initialTime","isTimeUp","setIsTimeUp","calculateSpeed","speedIncrease","max","minSpeed","speed","baseSpeed","generateFood","getRandomPosition","random","isPositionOccupied","pos","some","segment","newFood","generateSpecialFood","types","randomType","length","type","position","setTimeout","handleSpecialFoodEffect","s","prev","tail","newSegments","Array","fill","resetGame","current","moveSnake","prevSnake","head","newSnake","push","slice","handleKeyPress","e","key","code","preventDefault","document","addEventListener","gameInterval","setInterval","removeEventListener","clearInterval","startGame","updateScores","newScore","collectionName","scoresRef","scoreData","date","Date","error","console","queryConstraints","q","unsubscribe","snapshot","scores","docs","map","doc","_objectSpread","id","data","toDate","toLocaleString","currentRank","prevScore","rankedScores","filter","rank","timer","penaltyTime","setItem","toString","interval","className","children","concat","label","from","_","row","col","isSnake","isFood","isSpecialFood","onClick"],"sources":["/Users/zuuki/Desktop/Web/snake-game/src/components/SnakeGame.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { db } from '../firebase';\nimport { collection, addDoc, query, orderBy, limit, getDocs, where, onSnapshot } from 'firebase/firestore';\nimport '../styles/SnakeGame.css';\n\n// コレクション名を取得する関数を追加\nconst getCollectionName = (mode, difficulty) => {\n  if (mode === 'difficulty') {\n    switch (difficulty) {\n      case 'beginner':\n        return 'scoreslow';\n      case 'intermediate':\n        return 'scoresmiddle';\n      case 'advanced':\n        return 'scoreshigh';\n      default:\n        return 'scores';\n    }\n  }\n  return 'scores';\n};\n\nconst SnakeGame = ({ mode = 'normal', difficulty = 'normal', settings = null, onGameOver = null }) => {\n  const gridSize = 20;\n  const centerX = Math.floor(gridSize / 2);\n  const centerY = Math.floor(gridSize / 2);\n  \n  // initialSnakeをuseMemoで最適化\n  const initialSnake = React.useMemo(() => [\n    [centerX, centerY],     // 頭\n    [centerX - 1, centerY], // 胴体\n    [centerX - 2, centerY]  // 尾\n  ], [centerX, centerY]);\n\n  const [snake, setSnake] = useState(initialSnake);\n  const [food, setFood] = useState([0, 0]);\n  const [specialFood, setSpecialFood] = useState(null); // { type: 'yellow' | 'blue' | 'black', position: [x, y] }\n  const [direction, setDirection] = useState('RIGHT');\n  const directionRef = useRef(direction);\n  const [gameOver, setGameOver] = useState(false);\n  const [score, setScore] = useState(0);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [highScore, setHighScore] = useState(() => {\n    const saved = localStorage.getItem('snakeHighScore');\n    return saved ? parseInt(saved) : 0;\n  });\n  const [topScores, setTopScores] = useState([]);\n  const [timeLeft, setTimeLeft] = useState(mode === 'time' ? settings.initialTime : null);\n  const [isTimeUp, setIsTimeUp] = useState(false);\n\n  const calculateSpeed = useCallback((score) => {\n    if (mode === 'difficulty' && settings) {\n      const speedIncrease = Math.floor(score / 5) * settings.speedIncrease;\n      return Math.max(settings.minSpeed, settings.speed - speedIncrease);\n    }\n    // 通常モードのデフォルト速度計算\n    const baseSpeed = 200;\n    const speedIncrease = Math.floor(score / 5) * 10;\n    return Math.max(60, baseSpeed - speedIncrease);\n  }, [mode, settings]);\n\n  // generateFoodを先に定義\n  const generateFood = useCallback(() => {\n    const getRandomPosition = () => [\n      Math.floor(Math.random() * gridSize),\n      Math.floor(Math.random() * gridSize),\n    ];\n\n    const isPositionOccupied = (pos) => \n      snake.some(segment => segment[0] === pos[0] && segment[1] === pos[1]);\n\n    let newFood;\n    do {\n      newFood = getRandomPosition();\n    } while (isPositionOccupied(newFood));\n\n    setFood(newFood);\n  }, [snake, gridSize]);\n\n  // 特殊エサの生成関数\n  const generateSpecialFood = useCallback(() => {\n    if (mode !== 'time' || !isPlaying) return;\n\n    const types = ['yellow', 'blue', 'black'];\n    const randomType = types[Math.floor(Math.random() * types.length)];\n    \n    const getRandomPosition = () => [\n      Math.floor(Math.random() * gridSize),\n      Math.floor(Math.random() * gridSize),\n    ];\n\n    const isPositionOccupied = (pos) => \n      snake.some(segment => segment[0] === pos[0] && segment[1] === pos[1]) ||\n      (food[0] === pos[0] && food[1] === pos[1]);\n\n    let newFood;\n    do {\n      newFood = getRandomPosition();\n    } while (isPositionOccupied(newFood));\n\n    setSpecialFood({ type: randomType, position: newFood });\n\n    // 5秒後に特殊エサを消す\n    setTimeout(() => {\n      setSpecialFood(null);\n    }, 5000);\n  }, [snake, food, gridSize, mode, isPlaying]);\n\n  // 特殊エサの効果を処理\n  const handleSpecialFoodEffect = useCallback((type) => {\n    switch (type) {\n      case 'yellow':\n        setScore(s => s + 3); // 黄色は3点追加\n        break;\n      case 'blue':\n        setTimeLeft(prev => prev + 5); // 青は時間5秒追加\n        break;\n      case 'black':\n        setSnake(prev => { // 黒はヘビの長さを5増やす\n          const tail = prev[prev.length - 1];\n          const newSegments = Array(5).fill(tail);\n          return [...prev, ...newSegments];\n        });\n        break;\n      default:\n        break;\n    }\n  }, []);\n\n  // resetGameの定義\n  const resetGame = useCallback(() => {\n    setSnake(initialSnake);\n    setDirection('RIGHT');\n    setGameOver(false);\n    setScore(0);\n    setIsPlaying(false);\n    setFood([0, 0]); // エサを初期位置に戻す（次回開始時に新しい位置が生成される）\n  }, [initialSnake]);\n\n  useEffect(() => {\n    directionRef.current = direction;\n  }, [direction]);\n\n  const moveSnake = useCallback(() => {\n    if (!isPlaying || gameOver) return;\n\n    setSnake(prevSnake => {\n      const head = [...prevSnake[0]];\n      \n      switch (directionRef.current) {\n        case 'UP':\n          head[1] -= 1;\n          break;\n        case 'DOWN':\n          head[1] += 1;\n          break;\n        case 'LEFT':\n          head[0] -= 1;\n          break;\n        case 'RIGHT':\n          head[0] += 1;\n          break;\n        default:\n          break;\n      }\n\n      // 壁やヘビ自身との衝突判定\n      if (\n        head[0] < 0 ||\n        head[0] >= gridSize ||\n        head[1] < 0 ||\n        head[1] >= gridSize ||\n        prevSnake.some(segment => segment[0] === head[0] && segment[1] === head[1])\n      ) {\n        setGameOver(true);\n        setIsPlaying(false);\n        return prevSnake;\n      }\n\n      const newSnake = [head];\n\n      // 通常のエサとの衝突判定\n      if (head[0] === food[0] && head[1] === food[1]) {\n        setScore(s => s + 1);\n        generateFood();\n        newSnake.push(...prevSnake);\n      } else {\n        newSnake.push(...prevSnake.slice(0, -1));\n      }\n\n      // 特殊エサとの衝突判定を追加\n      if (specialFood && head[0] === specialFood.position[0] && head[1] === specialFood.position[1]) {\n        handleSpecialFoodEffect(specialFood.type);\n        setSpecialFood(null);\n      }\n\n      return newSnake;\n    });\n  }, [isPlaying, gameOver, food, generateFood, gridSize, specialFood, handleSpecialFoodEffect]);\n\n  // エサの生成を管理するuseEffect\n  useEffect(() => {\n    // エサが初期位置[0,0]の時のみ生成\n    if (food[0] === 0 && food[1] === 0) {\n      generateFood();\n    }\n  }, [generateFood, food]);\n\n  // キーボード入力とゲームループのuseEffectを修正（resetGameを先に定義）\n  useEffect(() => {\n    const handleKeyPress = (e) => {\n      if (e.key === 'ArrowUp' || \n          e.key === 'ArrowDown' || \n          e.key === 'ArrowLeft' || \n          e.key === 'ArrowRight' || \n          e.code === 'Space') {\n        e.preventDefault();\n      }\n\n      if (e.code === 'Space') {\n        if (gameOver) {\n          resetGame();\n        } else {\n          setIsPlaying(prev => !prev);\n        }\n        return;\n      }\n\n      if (!isPlaying) return;\n\n      switch (e.key) {\n        case 'ArrowUp':\n          if (directionRef.current !== 'DOWN') setDirection('UP');\n          break;\n        case 'ArrowDown':\n          if (directionRef.current !== 'UP') setDirection('DOWN');\n          break;\n        case 'ArrowLeft':\n          if (directionRef.current !== 'RIGHT') setDirection('LEFT');\n          break;\n        case 'ArrowRight':\n          if (directionRef.current !== 'LEFT') setDirection('RIGHT');\n          break;\n        default:\n          break;\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyPress);\n    const gameInterval = setInterval(moveSnake, calculateSpeed(score));\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyPress);\n      clearInterval(gameInterval);\n    };\n  }, [moveSnake, gameOver, isPlaying, score, calculateSpeed, resetGame]);\n\n  const startGame = () => {\n    if (!isPlaying && !gameOver) {\n      if (food[0] === 0 && food[1] === 0) {\n        generateFood(); // エサが初期位置の場合のみ生成\n      }\n      setIsPlaying(true);\n    }\n  };\n\n  // スコアを保存する関数を修正\n  const updateScores = useCallback(async (newScore) => {\n    try {\n      let collectionName;\n      \n      // モードに応じたコレクション名を設定\n      if (mode === 'time') {\n        if (timeLeft > 0) return; // 時間が残っている場合は記録しない\n        collectionName = 'scorestime';\n      } else if (mode === 'difficulty') {\n        collectionName = getCollectionName(mode, difficulty);\n      } else {\n        collectionName = 'scores'; // 通常モード\n      }\n\n      const scoresRef = collection(db, collectionName);\n      const scoreData = {\n        score: newScore,\n        date: new Date()\n      };\n\n      await addDoc(scoresRef, scoreData);\n    } catch (error) {\n      console.error('Error saving score:', error);\n    }\n  }, [mode, difficulty, timeLeft]);\n\n  // Firestoreのリアルタイムリスナーを設定\n  useEffect(() => {\n    // コレクション名の設定\n    const collectionName = mode === 'time' ? 'scorestime' : getCollectionName(mode, difficulty);\n    const scoresRef = collection(db, collectionName);\n    \n    // クエリの設定\n    const queryConstraints = [\n      orderBy('score', 'desc'),\n      limit(10)\n    ];\n\n    const q = query(scoresRef, ...queryConstraints);\n\n    // リアルタイムリスナーを設定\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const scores = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data(),\n        date: doc.data().date.toDate().toLocaleString()\n      }));\n\n      // 同点のスコアに同じ順位を付ける\n      let currentRank = 1;\n      let prevScore = null;\n\n      const rankedScores = scores.map((score) => {\n        if (prevScore !== null && score.score !== prevScore) {\n          currentRank = scores.filter(s => s.score > score.score).length + 1;\n        }\n        prevScore = score.score;\n        return {\n          ...score,\n          rank: currentRank\n        };\n      });\n\n      const topScores = rankedScores.filter(score => score.rank <= 5);\n      setTopScores(topScores);\n    });\n\n    return () => unsubscribe();\n  }, [mode, difficulty]);\n\n  // 制限時間の処理\n  useEffect(() => {\n    if (mode !== 'time' || !isPlaying) return;\n\n    const timer = setInterval(() => {\n      setTimeLeft(prev => {\n        if (prev <= 0) {\n          clearInterval(timer);\n          setIsTimeUp(true);\n          setIsPlaying(false);\n          // スコアの記録は別のuseEffectで行う\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [isPlaying, mode]);\n\n  // 時間切れ時のスコア記録用のuseEffect\n  useEffect(() => {\n    if (mode === 'time' && timeLeft === 0 && !isPlaying && !gameOver) {\n      updateScores(score);\n    }\n  }, [mode, timeLeft, isPlaying, gameOver, score, updateScores]);\n\n  // ゲームオーバー時の処理を修正\n  useEffect(() => {\n    if (!gameOver) return;\n\n    if (mode === 'time' && timeLeft > 0) {\n      // 制限時間モードでは即座に再開\n      setTimeLeft(prev => Math.max(0, prev - settings.penaltyTime));\n      setGameOver(false);\n      setSnake(initialSnake);\n      setDirection('RIGHT');\n      setIsPlaying(true);\n      generateFood(); // 新しい餌を生成\n    }\n  }, [gameOver, mode, timeLeft, settings, initialSnake, generateFood]);\n\n  // ゲームオーバー時のスコア更新を追加\n  useEffect(() => {\n    if (gameOver && score > 0 && mode !== 'time') {\n      updateScores(score);\n    }\n  }, [gameOver, score, mode, updateScores]);\n\n  // ハイスコアの更新処理を追加\n  useEffect(() => {\n    if (score > highScore) {\n      setHighScore(score);\n      localStorage.setItem('snakeHighScore', score.toString());\n    }\n  }, [score, highScore]);\n\n  // ランダムな間隔で特殊エサを生成\n  useEffect(() => {\n    if (mode !== 'time' || !isPlaying) return;\n\n    const interval = setInterval(() => {\n      if (!specialFood) {\n        generateSpecialFood();\n      }\n    }, Math.random() * 5000 + 5000); // 5-10秒のランダムな間隔\n\n    return () => clearInterval(interval);\n  }, [mode, isPlaying, specialFood, generateSpecialFood]);\n\n  return (\n    <div className=\"snake-game\">\n      <h2>\n        {mode === 'time' ? 'スネークゲーム - 制限時間モード' : \n         mode === 'difficulty' ? `スネークゲーム - ${settings.label}` : \n         'スネークゲーム'}\n      </h2>\n      {mode === 'time' && (\n        <div className=\"time-left\">残り時間: {timeLeft}秒</div>\n      )}\n      <div className=\"score-container\">\n        <div className=\"score\">現在のスコア: {score}</div>\n        <div className=\"high-score\">ハイスコア: {highScore}</div>\n      </div>\n      <div className=\"game-board\">\n        {Array.from({ length: gridSize }, (_, row) => (\n          <div key={row} className=\"row\">\n            {Array.from({ length: gridSize }, (_, col) => {\n              const isSnake = snake.some(\n                segment => segment[0] === col && segment[1] === row\n              );\n              const isFood = food[0] === col && food[1] === row;\n              const isSpecialFood = specialFood && \n                specialFood.position[0] === col && \n                specialFood.position[1] === row;\n              \n              return (\n                <div\n                  key={`${row}-${col}`}\n                  className={`cell \n                    ${isSnake ? 'snake' : ''} \n                    ${isFood ? 'food' : ''} \n                    ${isSpecialFood ? `special-food-${specialFood.type}` : ''}`\n                  }\n                />\n              );\n            })}\n          </div>\n        ))}\n      </div>\n      <div className=\"controls\">\n        {!isPlaying && !gameOver && !isTimeUp && (\n          <button onClick={startGame} className=\"start-button\">\n            スタート\n          </button>\n        )}\n        {isPlaying && (\n          <button onClick={() => setIsPlaying(false)} className=\"pause-button\">\n            一時停止\n          </button>\n        )}\n        {(gameOver && mode !== 'time') && (\n          <button onClick={resetGame} className=\"retry-button\">\n            もう一度プレイ\n          </button>\n        )}\n      </div>\n      <div className=\"ranking\">\n        <h3>歴代トップ5</h3>\n        <div className=\"ranking-list\">\n          {topScores.map((score) => (\n            <div key={score.id} className=\"ranking-item\">\n              <span className=\"rank\">{score.rank}位</span>\n              <span className=\"score-value\">{score.score}点</span>\n              <span className=\"score-date\">{score.date}</span>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SnakeGame; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}